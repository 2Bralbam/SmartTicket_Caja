---
import Layout from "../layouts/Layout.astro"
---
<link rel="stylesheet" type="text/css" href="homestyles.css">
<Layout title="Home">
    <main>
        <div class="infoContainer">
            <h2 class="welcomeTitle">Bienvenido <h2 class="nombre" id="nombre">Nombre</h2></h2>   
            <h3>Te encuentras en la caja 3</h3>
        </div>
        <section class="boxContainer">
            <div class="InteractiveBox">
                <div class="boxHeader">
                    <h1 class="boxTitle">
                        Turno actual:
                    </h1>
                    
                </div>
                <button class="content">
                    <p class="ticketTurno">
                        A001
                    </p>
                </button>  
            </div>
            <div class="bottomInteractiveBox">
                <div class="secondInteractiveBox">
                    <div class="boxHeader">
                        <h1 class="boxTitle">
                            Cerrar caja
                        </h1>
                        
                    </div>
                    <button class="content">
                        <svg xmlns="http://www.w3.org/2000/svg" width="148" height="148" viewBox="0 0 24 24"><path fill="#043263" d="m12 13.4l2.9 2.9q.275.275.7.275t.7-.275t.275-.7t-.275-.7L13.4 12l2.9-2.9q.275-.275.275-.7t-.275-.7t-.7-.275t-.7.275L12 10.6L9.1 7.7q-.275-.275-.7-.275t-.7.275t-.275.7t.275.7l2.9 2.9l-2.9 2.9q-.275.275-.275.7t.275.7t.7.275t.7-.275zm0 8.6q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"/></svg>
                    </button>  
                </div><div class="thirdInteractiveBox">
                    <div class="boxHeader">
                        <h1 class="boxTitle">
                            Siguiente
                        </h1>
                        
                    </div>
                    <button class="content">
                        <svg xmlns="http://www.w3.org/2000/svg" width="148" height="148" viewBox="0 0 24 24"><path fill="#043263" d="m12.2 13l-.9.9q-.275.275-.275.7t.275.7t.7.275t.7-.275l2.6-2.6q.3-.3.3-.7t-.3-.7l-2.6-2.6q-.275-.275-.7-.275t-.7.275t-.275.7t.275.7l.9.9H9q-.425 0-.712.288T8 12t.288.713T9 13zm-.2 9q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"/></svg>
                    </button>  
                </div>
            </div>
        </section>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/3.1.7/signalr.min.js" is:inline></script>
        <script is:inline>
            let JWTToken = localStorage.getItem('token');
            const TituloNombre = document.querySelector('#nombre');
            if(JWTToken == null || JWTToken == undefined){
                window.location.href = "/index";
            }
            else{
                let decodedToken = parseJwt(JWTToken);
                let Rol = decodedToken.role;
                if(Rol != "Cajero" && Rol != "Admin" || Rol == null || Rol == undefined){
                    window.location.href = "/Index";
                }
                let IdUsuario = decodedToken.id;
                let Nombre = decodedToken.unique_name;
                TituloNombre.textContent = Nombre;
                console.log(parseJwt(JWTToken));
                
            }
            function parseJwt(token) {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(window.atob(base64).split('').map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''));
                return JSON.parse(jsonPayload);
            }
        </script>
        <script is:inline>
            const connection = new signalR.HubConnectionBuilder()
                .withUrl("https://localhost:7069/tickets")
                .configureLogging(signalR.LogLevel.Information)
                .build();
            async function IniciarConexion(){
                try {
                    await connection.start();
                    console.log("ConexiÃ³n establecida");
                } catch (error) {
                    console.log(error);
                }
            }
            connection.onclose(async () => {
                await IniciarConexion();
            });
            IniciarConexion();
        </script>
</main>
<footer>

</footer>
</Layout>
    </main>
    <footer>
    
    </footer>
</Layout>
